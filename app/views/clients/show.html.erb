<div class="client-container">
  <div class="name-wrap">
    <% if @client.photos.count > 0 %>
      <div class='img-container'>
        <%= link_to image_tag(@client.photos.last.avatar.url(:thumb)), @client.photos.last.avatar.url(:medium), :target => "_blank" %>
      </div>
    <% else %>
       <div class='img-container'>
        <%= image_tag("default_profile_pic.jpg", width: "100", height: "100") %>
      </div>
    <% end %>
    <header>
      <h1 class='client-name-show'><%= @client.name %></h1>

      <% if @client.cards.present? && @upcoming_sessions_by_session_tag.count >= 16 %>
        <!-- <p class='create-workout'><%#= @client.first_name %> has 3 routines on his card.</p> -->
      <% elsif @client.cards.present? && @upcoming_sessions_by_session_tag.count > 0 %>
        <p class='create-workout'><%= link_to "<i class=\"fa fa-plus-square-o\"></i> Add routine".html_safe, new_workout_session_url(client_id: @client.id) %></p>
      <% else %>
        <p class='create-workout'><%= link_to "<i class=\"fa fa-plus-square-o\"></i> Create new card".html_safe, new_workout_session_url(client_id: @client.id) %></p>
      <% end %>
      <p class='client-email'><%= @client.email %></p>
      <% if @client.goals.present? %>
        <p class='goal-parent'>Current goal: <span class='current-goal'>“<%= @client.goals.last.content %>”</span></p>
      <% end %>
    </header>
  </div>

  <ul class="tab-links">
    <li>
      <%= link_to "<i class=\"fa fa-align-left\"></i> Schedule".html_safe, "#", class: 'schedule-tab active', id: 'schedule-tab' %>
    </li>
    <li>
      <%= link_to "<i class=\"fa fa-pencil-square-o\"></i> Notes".html_safe, "#", class: 'note-tab', id: 'note-tab' %>
    </li>
    <li>
      <%= link_to "<i class=\'fa fa-user\'></i> Body profile".html_safe, "#", class: 'body-profile-tab-link', id: 'body-profile-tab' %>
    </li>
    <!-- <li>
      <%#= link_to "<i class=\"fa fa-align-left\"></i> Graph".html_safe, "#", class: 'graph-tab', id: 'graph-tab' %>
    </li> -->
  </ul>

  <div class="schedule-tab-container">
    <section class="upcoming-container set-parent-height">
      <h4 class='client-card-session-count'>
        <span><%= @current_card.finished_sessions.count %>/<%= @current_card.sessions.count %></span> sessions completed
      </h4>

      <h5><%= @client.first_name %>'s next session is <%= link_to "#{@next_session.name} (#{@next_session.session_tag})", workout_session_url(@next_session.id) %></h5>

      <div class="last-time">
        <% if @current_card.started? %>
          <p class='last-time-sentence'><%= time_ago_in_words(@last_session.exercise_executions.first.created_at) %> ago <%= @client.first_name %> did <%= link_to "#{@last_session.name} (#{@last_session.session_tag})", workout_session_url(@last_session.id) %> with <%= @last_session.coach %></p>
        <% end %>
      </div>

      <div class="see-completed-container">
        <%= link_to "See completed sessions from this card", "#previous-session", class: 'see-completed-sessions-link', id: "see-previous-sessions" %>
        <p></p>
      </div>
    </section>

    <section class="previous-sessions set-parent-height" id="previous-session">
      <h2><%= pluralize(@previous_sessions.count, "Previous Session") %></h2>
        <table>
           <tr>
            <th>Sessions</th>
            <th>Routine</th>
            <th>Coach</th>
            <th>Date</th>
          </tr>

        <% @previous_sessions.reverse.each do |session| %>
          <tr>
            <td><%= link_to("Session ##{session.id}", workout_session_url(session.id)) %></td>
            <td><%= session.session_tag %></td>
            <td><%= session.coach %></td>
            <td><%= session.date.strftime('%B %d, %Y') %></td>
          </tr>
        <% end %>
        </table>
    </section>
  </div>

  <div class="client-note-container hide">
    <%= form_tag note_client_url, method: 'post', remote: true do %>
      <%= text_field_tag :content, nil, placeholder: "Write a note about #{@client.first_name}" %>
      <%= hidden_field_tag :client_id, @client.id %>
      <%= hidden_field_tag :client_page, true %>
      <%= submit_tag "Submit" %>
    <% end %>

    <% if @client.notes.present? %>
      <ul>
        <% @client.notes.reverse.each do |note| %>
          <li><%= note.content %><span><%= note.created_at.strftime("%B %d, %Y") %></span></li>
        <% end %>
      </ul>
    <% else %>
    <div class="no-notes-note-container">
      <div class='no-note-message'>
        <h3>Write the first note to make sure you're staying on top of <%= @client.first_name %>!</h3>
      </div>
    </div>
    <div class="no-note-img-container">
      <%= image_tag('notes-filler-image.png', width: '500px', height: '500px') %>
    </div>
    <% end %>
  </div> <!-- note-container -->

  <div class="body-profile-tab hide">
    <%= render 'stat_index', client: @client %>
  </div>

  <!-- <div class="graph-tab-container hide">
    <div class="graph-container">
      <%# if @client.exercise_executions.present? %>
        <%#= render 'client_graph', client: @client, exercise: @exercise, exercises: @exercises, type: @type %>
      <%# else %>
        <div class="no-graph-note-container">
          <div class='no-graph-message'>
            <h3>As soon as <%#= @client.first_name %> starts working out, we'll graph it!</h3>
          </div>
        </div>
        <div class="no-graph-img-container">
          <%#= image_tag('graph-filler-image.png', width: '500', height: '500') %>
        </div>
      <%# end %>
    </div>
  </div> <!-- tab-container -->
</div>


<script type="text/javascript">
  $(document).ready(function(){
    var containerHeight = $('.schedule-tab-container').height();
    console.log(containerHeight);
    $('.set-parent-height').css({"height": containerHeight});

    $('#see-previous-sessions').click(function() {
        if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'')
            || location.hostname == this.hostname) {
          var target = $(this.hash);
          console.log(target)
          target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
          if (target.length) {
            $('html,body').animate({
              scrollTop: target.offset().top
            }, 1000);
            return false;
          }
        }
      });
  });
</script>
